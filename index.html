<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Meal Planner</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        /* Hide scrollbar for Chrome, Safari and Opera */
        .scrollbar-hide::-webkit-scrollbar {
            display: none;
        }
        /* Hide scrollbar for IE, Edge and Firefox */
        .scrollbar-hide {
            -ms-overflow-style: none;  /* IE and Edge */
            scrollbar-width: none;  /* Firefox */
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
        }
    </style>
</head>
<body class="bg-gray-50 text-slate-800">

    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useRef } = React;

        // --- ICONS (Inline SVGs to replace Lucide-React imports) ---
        const IconBase = ({ children, size = 24, className = "", ...props }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className} {...props}>
                {children}
            </svg>
        );

        const ChefHat = (props) => <IconBase {...props}><path d="M6 13.87A4 4 0 0 1 7.41 6a5.11 5.11 0 0 1 1.05-1.54 5 5 0 0 1 7.08 0A5.11 5.11 0 0 1 16.59 6 4 4 0 0 1 18 13.87V21H6Z"/><line x1="6" y1="17" x2="18" y2="17"/></IconBase>;
        const Clock = (props) => <IconBase {...props}><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></IconBase>;
        const List = (props) => <IconBase {...props}><line x1="8" y1="6" x2="21" y2="6"/><line x1="8" y1="12" x2="21" y2="12"/><line x1="8" y1="18" x2="21" y2="18"/><line x1="3" y1="6" x2="3.01" y2="6"/><line x1="3" y1="12" x2="3.01" y2="12"/><line x1="3" y1="18" x2="3.01" y2="18"/></IconBase>;
        const RefreshCw = (props) => <IconBase {...props}><path d="M21 2v6h-6"/><path d="M3 12a9 9 0 0 1 15-6.7L21 8"/><path d="M3 22v-6h6"/><path d="M21 12a9 9 0 0 1-15 6.7L3 16"/></IconBase>;
        const ShoppingCart = (props) => <IconBase {...props}><circle cx="9" cy="21" r="1"/><circle cx="20" cy="21" r="1"/><path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"/></IconBase>;
        const Utensils = (props) => <IconBase {...props}><path d="M3 2v7c0 1.1.9 2 2 2h4a2 2 0 0 0 2-2V2"/><path d="M7 2v20"/><path d="M21 15V2v0a5 5 0 0 0-5 5v6c0 1.1.9 2 2 2h3Zm0 0v7"/></IconBase>;
        const Camera = (props) => <IconBase {...props}><path d="M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z"/><circle cx="12" cy="13" r="3"/></IconBase>;
        const XIcon = (props) => <IconBase {...props}><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></IconBase>;
        const Flame = (props) => <IconBase {...props}><path d="M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.1.2-2.2.5-3.27.57 2.227 1.252 4.414 3 6.77z"/></IconBase>;
        const Home = (props) => <IconBase {...props}><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></IconBase>;
        const CheckCircle = (props) => <IconBase {...props}><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></IconBase>;
        const Edit = (props) => <IconBase {...props}><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></IconBase>;
        const Settings = (props) => <IconBase {...props}><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/></IconBase>;

        // --- ADVANCED RECIPE GENERATOR ENGINE ---
        // (Procedurally generates 600+ unique meal combinations)

        const PROTEIN_CUTS = {
          'Chicken': ['Breasts', 'Thighs', 'Drumsticks', 'Tenders', 'Whole Roast'],
          'Beef': ['Sirloin Steaks', 'Ground Beef', 'Chuck Roast', 'Strip Steaks', 'Stew Meat'],
          'Pork': ['Chops', 'Loin', 'Ribs', 'Sausage Links', 'Ground Pork'],
          'Fish': ['Salmon Fillet', 'Cod Loins', 'Tilapia Fillets', 'Jumbo Shrimp', 'Tuna Steaks'],
          'Vegetarian': ['Firm Tofu', 'Halloumi Cheese', 'Chickpeas', 'Lentils', 'Eggplant'],
          'Vegan': ['Tempeh', 'Black Beans', 'Seitan', 'Jackfruit', 'Cauliflower Steaks']
        };

        const STYLES = ['Roasted', 'Grilled', 'Pan-Seared', 'Slow-Cooked', 'Stir-Fried', 'Baked', 'Braised', 'Air-Fried'];

        const FLAVOR_PROFILES = {
          'Lemon Herb': {
            ingredients: [
              { item: 'Lemons', amount: '2', unit: 'whole' },
              { item: 'Fresh Parsley', amount: '1', unit: 'bunch' },
              { item: 'Dried Oregano', amount: '1', unit: 'tsp' }
            ],
            tags: ['Fresh', 'Light']
          },
          'Garlic Butter': {
            ingredients: [
              { item: 'Unsalted Butter', amount: '4', unit: 'tbsp' },
              { item: 'Garlic', amount: '6', unit: 'cloves' },
              { item: 'Italian Seasoning', amount: '1', unit: 'tbsp' }
            ],
            tags: ['Keto', 'Comfort']
          },
          'Spicy BBQ': {
            ingredients: [
              { item: 'BBQ Sauce', amount: '0.5', unit: 'cup' },
              { item: 'Chili Powder', amount: '1', unit: 'tsp' },
              { item: 'Cayenne Pepper', amount: '0.5', unit: 'tsp' },
              { item: 'Red Onion', amount: '1', unit: 'medium' }
            ],
            tags: ['Spicy', 'Kid-Friendly']
          },
          'Teriyaki': {
            ingredients: [
              { item: 'Soy Sauce', amount: '0.5', unit: 'cup' },
              { item: 'Fresh Ginger', amount: '1', unit: 'inch piece' },
              { item: 'Honey', amount: '2', unit: 'tbsp' },
              { item: 'Sesame Seeds', amount: '1', unit: 'tsp' }
            ],
            tags: ['Sweet', 'Asian-Inspired']
          },
          'Mediterranean': {
            ingredients: [
              { item: 'Kalamata Olives', amount: '0.5', unit: 'cup' },
              { item: 'Feta Cheese', amount: '0.5', unit: 'cup' },
              { item: 'Cherry Tomatoes', amount: '1', unit: 'pint' },
              { item: 'Cucumber', amount: '1', unit: 'whole' }
            ],
            tags: ['Healthy', 'Keto']
          },
          'Cajun': {
            ingredients: [
              { item: 'Cajun Seasoning', amount: '2', unit: 'tbsp' },
              { item: 'Bell Peppers', amount: '2', unit: 'sliced' },
              { item: 'Celery', amount: '2', unit: 'stalks' },
              { item: 'Onion', amount: '1', unit: 'large' }
            ],
            tags: ['Spicy', 'Hearty']
          },
          'Creamy Mushroom': {
            ingredients: [
              { item: 'Heavy Cream', amount: '0.5', unit: 'cup' },
              { item: 'Mushrooms', amount: '8', unit: 'oz' },
              { item: 'Thyme', amount: '2', unit: 'sprigs' },
              { item: 'Shallot', amount: '1', unit: 'minced' }
            ],
            tags: ['Keto', 'Rich']
          },
          'Zesty Lime': {
            ingredients: [
              { item: 'Limes', amount: '3', unit: 'whole' },
              { item: 'Cilantro', amount: '1', unit: 'bunch' },
              { item: 'Cumin', amount: '1', unit: 'tsp' }
            ],
            tags: ['Paleo', 'Fresh']
          },
          'Sweet & Sour': {
            ingredients: [
              { item: 'Pineapple Chunks', amount: '1', unit: 'cup' },
              { item: 'Bell Peppers', amount: '2', unit: 'chopped' },
              { item: 'Rice Vinegar', amount: '2', unit: 'tbsp' },
              { item: 'Ketchup', amount: '2', unit: 'tbsp' }
            ],
            tags: ['Kid-Friendly', 'Sweet']
          },
          'Honey Glazed': {
            ingredients: [
              { item: 'Honey', amount: '0.25', unit: 'cup' },
              { item: 'Mustard', amount: '1', unit: 'tbsp' },
              { item: 'Apple Cider Vinegar', amount: '1', unit: 'tbsp' }
            ],
            tags: ['Kid-Friendly', 'Sweet']
          },
          'Pesto': {
            ingredients: [
              { item: 'Basil Pesto', amount: '0.5', unit: 'jar' },
              { item: 'Parmesan Cheese', amount: '0.25', unit: 'cup' },
              { item: 'Pine Nuts', amount: '1', unit: 'tbsp' }
            ],
            tags: ['Keto', 'Fast']
          },
          'Coconut Curry': {
            ingredients: [
              { item: 'Coconut Milk', amount: '1', unit: 'can' },
              { item: 'Red Curry Paste', amount: '2', unit: 'tbsp' },
              { item: 'Lime', amount: '1', unit: 'juiced' }
            ],
            tags: ['Paleo', 'Dairy-Free']
          }
        };

        const SIDES_POOL = [
          { name: 'Steamed Broccoli', ingredients: [{ item: 'Broccoli Crown', amount: '1', unit: 'head' }] },
          { name: 'Jasmine Rice', ingredients: [{ item: 'Jasmine Rice', amount: '1.5', unit: 'cups' }] },
          { name: 'Roasted Potatoes', ingredients: [{ item: 'Red Potatoes', amount: '1', unit: 'lb' }] },
          { name: 'Quinoa Salad', ingredients: [{ item: 'Quinoa', amount: '1', unit: 'cup' }, { item: 'Cucumber', amount: '1', unit: 'diced' }] },
          { name: 'Glazed Carrots', ingredients: [{ item: 'Carrots', amount: '1', unit: 'bunch' }, { item: 'Honey', amount: '1', unit: 'tbsp' }] },
          { name: 'Cauliflower Rice', ingredients: [{ item: 'Cauliflower Rice', amount: '1', unit: 'bag' }] },
          { name: 'Green Beans', ingredients: [{ item: 'Fresh Green Beans', amount: '1', unit: 'lb' }] },
          { name: 'Asparagus', ingredients: [{ item: 'Asparagus', amount: '1', unit: 'bunch' }] },
          { name: 'Sweet Potato Fries', ingredients: [{ item: 'Sweet Potatoes', amount: '2', unit: 'large' }] },
          { name: 'Zucchini Noodles', ingredients: [{ item: 'Zucchini', amount: '3', unit: 'medium' }] }
        ];

        const getMainUnit = (cut) => {
          if (cut.includes('Steak') || cut.includes('Chops') || cut.includes('Fillet') || cut.includes('Chicken Breast')) return 'pieces';
          if (cut.includes('Ground') || cut.includes('Meat')) return 'lb';
          if (cut.includes('Whole') || cut.includes('Roast')) return 'whole';
          if (cut.includes('Shrimp')) return 'lb';
          if (cut.includes('Tofu')) return 'block';
          if (cut.includes('Beans') || cut.includes('Chickpeas')) return 'cans';
          return 'pack';
        };

        const generateExtensiveDatabase = () => {
          const generatedRecipes = [];
          let idCounter = 1;
          const proteins = Object.keys(PROTEIN_CUTS);
          const flavors = Object.keys(FLAVOR_PROFILES);

          proteins.forEach(proteinCategory => {
            const cuts = PROTEIN_CUTS[proteinCategory];
            if (!cuts) return;

            cuts.forEach(cut => {
              flavors.forEach(flavorName => {
                const selectedStyles = [STYLES[Math.floor(Math.random() * STYLES.length)], STYLES[Math.floor(Math.random() * STYLES.length)]];

                selectedStyles.forEach(style => {
                  const flavorProfile = FLAVOR_PROFILES[flavorName];
                  if (!flavorProfile) return;

                  const isSpicy = flavorName.includes('Spicy') || flavorName.includes('Cajun') || flavorName.includes('Curry');
                  const isSweet = flavorName.includes('Honey') || flavorName.includes('Sweet') || flavorName.includes('Teriyaki');
                  const isKeto = (proteinCategory !== 'Vegetarian' && proteinCategory !== 'Vegan' && !isSweet && !flavorName.includes('Teriyaki'));
                  const isPaleo = isKeto && !flavorName.includes('Cheese') && !flavorName.includes('Cream');
                  const isKidFriendly = !isSpicy && flavorProfile.tags.includes('Kid-Friendly');
                  const isFast = ['Stir-Fried', 'Pan-Seared', 'Grilled', 'Air-Fried'].includes(style);

                  const ingredients = [];
                  
                  ingredients.push({ 
                    item: cut, 
                    amount: cut.includes('Whole') ? '1' : (cut.includes('Steak') ? '2' : '1'), 
                    unit: getMainUnit(cut) 
                  });

                  if (flavorProfile.ingredients) {
                     ingredients.push(...flavorProfile.ingredients);
                  }

                  ingredients.push({ item: 'Olive Oil', amount: '2', unit: 'tbsp' });
                  ingredients.push({ item: 'Salt & Pepper', amount: 'to taste', unit: '' });

                  const sideDish = SIDES_POOL[Math.floor(Math.random() * SIDES_POOL.length)];
                  if (sideDish && sideDish.ingredients) {
                     ingredients.push(...sideDish.ingredients);
                  }

                  const baseCals = proteinCategory === 'Vegetarian' ? 350 : 500;
                  const variance = Math.floor(Math.random() * 150) - 50;

                  generatedRecipes.push({
                    id: `gen_${idCounter++}`,
                    name: `${flavorName} ${style} ${cut}`,
                    protein: proteinCategory,
                    subType: cut,
                    calories: baseCals + variance,
                    time: isFast ? 25 : 45 + Math.floor(Math.random() * 20),
                    ingredientsCount: ingredients.length,
                    tags: [
                      isFast ? 'Under 30' : 'Slow Cook', 
                      isKeto ? 'Keto' : '', 
                      isPaleo ? 'Paleo' : '',
                      isKidFriendly ? 'Kid-Friendly' : '',
                      ...(flavorProfile.tags || [])
                    ].filter(Boolean),
                    ingredients: ingredients,
                    instructions: [
                      `Prepare the ${cut} by patting dry.`,
                      `Mix the seasoning ingredients to create your sauce.`,
                      `Heat your cooking appliance for ${style.toLowerCase()}.`,
                      `Cook ${cut} for the required time until internal temperature is safe.`,
                      `Prepare ${sideDish.name} according to standard instructions.`,
                      `Serve ${cut} topped with remaining sauce/juices.`
                    ],
                    nutrition: { 
                      protein: `${Math.floor(Math.random() * 15 + 25)}g`, 
                      carbs: isKeto ? '6g' : '45g', 
                      fat: '22g' 
                    },
                    sides: [sideDish.name],
                    substitutes: { 
                      [cut]: 'Tofu or Chicken Breast'
                    },
                    kidFriendly: isKidFriendly
                  });
                });
              });
            });
          });
          return generatedRecipes;
        };

        const RECIPES = generateExtensiveDatabase();
        const DAYS = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday'];
        const PROTEINS = ['Chicken', 'Beef', 'Pork', 'Fish', 'Vegetarian', 'Vegan'];

        function MealPlannerApp() {
          const [activeTab, setActiveTab] = useState('dashboard');
          const [selectedDay, setSelectedDay] = useState('Monday');
          const [weeklyPlan, setWeeklyPlan] = useState([]);
          
          const [prefs, setPrefs] = useState({
            maxCalories: 900,
            isFast: false,
            diet: 'None',
            kidFriendly: false
          });

          const [dailyProteins, setDailyProteins] = useState({
            Monday: 'Any',
            Tuesday: 'Any',
            Wednesday: 'Any',
            Thursday: 'Any',
            Friday: 'Any',
            Saturday: 'Any',
            Sunday: 'Any'
          });

          const [showCustomizeModal, setShowCustomizeModal] = useState(false);
          const [checkedItems, setCheckedItems] = useState({});

          // Camera Logic
          const fileInputRef = useRef(null);
          const [isScanning, setIsScanning] = useState(false);
          const [scannedImage, setScannedImage] = useState(null);
          const [scanResults, setScanResults] = useState([]);

          const handleFileSelect = (event) => {
            const file = event.target.files[0];
            if (file) {
                setIsScanning(true);
                // Create preview
                const reader = new FileReader();
                reader.onloadend = () => {
                    setScannedImage(reader.result);
                    
                    // Simulate AI processing delay
                    setTimeout(() => {
                        setIsScanning(false);
                        // Simulation: Pick 3-5 random recipes
                        const shuffled = [...RECIPES].sort(() => 0.5 - Math.random());
                        setScanResults(shuffled.slice(0, 4)); 
                    }, 2000);
                };
                reader.readAsDataURL(file);
            }
          };

          useEffect(() => {
            regeneratePlan();
          }, []); 

          const regeneratePlan = () => {
            const newPlan = DAYS.map(day => {
              const requiredProtein = dailyProteins[day];

              let pool = RECIPES.filter(r => {
                if (requiredProtein !== 'Any' && r.protein !== requiredProtein) return false;
                if (prefs.isFast && r.time > 30) return false;
                if (r.calories > prefs.maxCalories) return false;
                if (prefs.diet === 'Keto' && !r.tags.includes('Keto')) return false;
                if (prefs.diet === 'Paleo' && !r.tags.includes('Paleo')) return false;
                if (prefs.diet === 'Vegan' && r.protein !== 'Vegan') return false;
                if (prefs.kidFriendly && !r.tags.includes('Kid-Friendly')) return false;
                return true;
              });

              if (pool.length === 0) {
                if (requiredProtein !== 'Any') {
                    pool = RECIPES.filter(r => r.protein === requiredProtein);
                } else {
                    pool = RECIPES;
                }
              }

              if (pool.length === 0) {
                  pool = RECIPES; 
              }

              return {
                day,
                recipe: pool[Math.floor(Math.random() * pool.length)]
              };
            });
            setWeeklyPlan(newPlan);
            setCheckedItems({});
            setShowCustomizeModal(false);
          };

          const swapMeal = (dayIndex) => {
            const dayName = weeklyPlan[dayIndex].day;
            const requiredProtein = dailyProteins[dayName];
            const currentId = weeklyPlan[dayIndex].recipe.id;

            let pool = RECIPES.filter(r => {
                if (requiredProtein !== 'Any' && r.protein !== requiredProtein) return false;
                if (prefs.isFast && r.time > 30) return false;
                if (prefs.diet === 'Keto' && !r.tags.includes('Keto')) return false;
                if (prefs.kidFriendly && !r.tags.includes('Kid-Friendly')) return false;
                return r.id !== currentId;
            });

            if (pool.length === 0) pool = RECIPES;

            const newRecipe = pool[Math.floor(Math.random() * pool.length)];
            const newPlan = [...weeklyPlan];
            newPlan[dayIndex].recipe = newRecipe;
            setWeeklyPlan(newPlan);
          };

          const currentMeal = weeklyPlan.find(p => p.day === selectedDay)?.recipe;

          const groceryList = useMemo(() => {
            const list = {};
            weeklyPlan.forEach(({ recipe }) => {
              if (!recipe) return;
              recipe.ingredients.forEach(ing => {
                if (!list[ing.item]) {
                  list[ing.item] = { 
                    name: ing.item, 
                    entries: [`${ing.amount} ${ing.unit}`] 
                  };
                } else {
                  list[ing.item].entries.push(`${ing.amount} ${ing.unit}`);
                }
              });
            });
            
            return Object.values(list).sort((a,b) => a.name.localeCompare(b.name)).map(item => {
              return {
                name: item.name,
                amountDisplay: item.entries.join(' + ')
              };
            });
          }, [weeklyPlan]);

          const toggleGroceryItem = (item) => {
            setCheckedItems(prev => ({...prev, [item]: !prev[item]}));
          };

          return (
            <div className="flex h-screen bg-gray-50 text-slate-800 font-sans overflow-hidden">
              
              <aside className="hidden md:flex flex-col w-64 bg-slate-900 text-white shadow-xl z-20">
                <div className="p-6 flex items-center gap-3">
                  <div className="bg-emerald-500 p-2 rounded-lg">
                    <ChefHat size={24} className="text-white" />
                  </div>
                  <div>
                    <h1 className="font-bold text-lg tracking-tight">MealMaster</h1>
                    <p className="text-xs text-slate-400">Pro Edition</p>
                  </div>
                </div>

                <nav className="flex-1 px-4 space-y-2 mt-4">
                  <NavItem icon={<Home size={20}/>} label="Dashboard" active={activeTab === 'dashboard'} onClick={() => setActiveTab('dashboard')} />
                  <NavItem icon={<ShoppingCart size={20}/>} label="Grocery List" active={activeTab === 'grocery'} onClick={() => setActiveTab('grocery')} />
                  <NavItem icon={<Camera size={20}/>} label="Pantry Scanner" active={activeTab === 'scanner'} onClick={() => setActiveTab('scanner')} />
                  <NavItem icon={<Settings size={20}/>} label="Preferences" active={activeTab === 'settings'} onClick={() => setActiveTab('settings')} />
                </nav>

                <div className="p-4 border-t border-slate-800">
                   <div className="text-xs text-slate-500 text-center">
                      Works on GitHub Pages & Netlify
                   </div>
                </div>
              </aside>

              <div className="md:hidden fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 z-50 flex justify-around p-3 pb-6">
                <MobileNavItem icon={<Home size={20}/>} label="Home" active={activeTab === 'dashboard'} onClick={() => setActiveTab('dashboard')} />
                <MobileNavItem icon={<ShoppingCart size={20}/>} label="Shop" active={activeTab === 'grocery'} onClick={() => setActiveTab('grocery')} />
                <MobileNavItem icon={<Settings size={20}/>} label="Prefs" active={activeTab === 'settings'} onClick={() => setActiveTab('settings')} />
              </div>

              <main className="flex-1 flex flex-col h-full overflow-hidden relative">
                
                <div className="md:hidden bg-white p-4 flex justify-between items-center shadow-sm z-10">
                   <div className="flex items-center gap-2">
                     <ChefHat className="text-emerald-600" size={24}/>
                     <span className="font-bold text-lg">MealMaster</span>
                   </div>
                </div>

                {activeTab === 'dashboard' && (
                  <div className="flex-1 flex flex-col overflow-hidden">
                    
                    <div className="bg-white border-b border-gray-200 p-4 md:p-6 shadow-sm z-10 flex-shrink-0">
                       <div className="flex flex-col md:flex-row md:justify-between md:items-center mb-4 gap-3">
                          <h2 className="text-xl md:text-2xl font-bold text-slate-800">Your Weekly Menu</h2>
                          <div className="flex gap-2">
                            <button 
                                onClick={() => setShowCustomizeModal(true)}
                                className="flex items-center gap-2 text-sm font-medium text-slate-600 bg-slate-100 hover:bg-slate-200 px-3 py-2 rounded-lg transition-colors"
                            >
                                <Edit size={16} /> Customize Menu
                            </button>
                            <button 
                                onClick={regeneratePlan}
                                className="flex items-center gap-2 text-sm font-medium text-emerald-600 bg-emerald-50 hover:bg-emerald-100 px-3 py-2 rounded-lg transition-colors"
                            >
                                <RefreshCw size={16} /> Regenerate
                            </button>
                          </div>
                       </div>
                       
                       <div className="flex gap-2 md:gap-4 overflow-x-auto pb-2 scrollbar-hide">
                          {weeklyPlan.map((item, idx) => (
                            <button
                              key={item.day}
                              onClick={() => setSelectedDay(item.day)}
                              className={`flex flex-col items-center min-w-[80px] md:min-w-[100px] p-3 rounded-2xl border transition-all ${
                                selectedDay === item.day 
                                ? 'border-emerald-500 bg-emerald-50 shadow-md transform scale-105' 
                                : 'border-gray-100 bg-white hover:border-emerald-200'
                              }`}
                            >
                               <span className={`text-xs font-bold uppercase mb-1 ${selectedDay === item.day ? 'text-emerald-700' : 'text-gray-400'}`}>
                                 {item.day.substring(0,3)}
                               </span>
                               <div className={`w-8 h-8 rounded-full flex items-center justify-center mb-2 ${selectedDay === item.day ? 'bg-emerald-500 text-white' : 'bg-gray-100 text-gray-400'}`}>
                                  <Utensils size={14} />
                               </div>
                               <span className="text-[10px] text-center truncate w-full px-1 font-medium text-slate-600">
                                 {item.recipe ? item.recipe.protein : 'None'}
                               </span>
                            </button>
                          ))}
                       </div>
                    </div>

                    <div className="flex-1 overflow-y-auto p-4 md:p-8 bg-slate-50/50 pb-24">
                       {currentMeal ? (
                         <div className="max-w-4xl mx-auto grid grid-cols-1 lg:grid-cols-3 gap-8 pb-20">
                            
                            <div className="lg:col-span-2 space-y-6">
                               <div className="bg-white rounded-3xl p-6 md:p-8 shadow-sm border border-gray-100 relative overflow-hidden group">
                                  <div className="absolute top-0 right-0 w-64 h-64 bg-emerald-50 rounded-full -mr-16 -mt-16 opacity-50 group-hover:scale-110 transition-transform duration-700"></div>

                                  <div className="relative z-10">
                                    <div className="flex justify-between items-start mb-4">
                                      <span className="bg-emerald-100 text-emerald-800 px-3 py-1 rounded-full text-xs font-bold uppercase tracking-wide">
                                        {currentMeal.protein}
                                      </span>
                                      <div className="flex gap-2">
                                         <button 
                                           onClick={() => swapMeal(weeklyPlan.findIndex(x => x.day === selectedDay))}
                                           className="text-gray-400 hover:text-emerald-600 p-2 hover:bg-gray-50 rounded-full transition-colors" 
                                           title="Swap this specific meal"
                                         >
                                            <RefreshCw size={20} />
                                         </button>
                                      </div>
                                    </div>
                                    
                                    <h2 className="text-3xl md:text-4xl font-extrabold text-slate-800 mb-4 leading-tight">
                                      {currentMeal.name}
                                    </h2>

                                    <div className="flex flex-wrap gap-4 text-sm text-slate-500 mb-8">
                                       <div className="flex items-center gap-2 bg-gray-50 px-3 py-1.5 rounded-lg">
                                         <Clock size={18} className="text-emerald-500"/> 
                                         <span className="font-medium">{currentMeal.time} mins</span>
                                       </div>
                                       <div className="flex items-center gap-2 bg-gray-50 px-3 py-1.5 rounded-lg">
                                         <Flame size={18} className="text-orange-500"/> 
                                         <span className="font-medium">{currentMeal.calories} kcal</span>
                                       </div>
                                       <div className="flex items-center gap-2 bg-gray-50 px-3 py-1.5 rounded-lg">
                                         <List size={18} className="text-blue-500"/> 
                                         <span className="font-medium">{currentMeal.ingredientsCount} items</span>
                                       </div>
                                    </div>

                                    <div className="border-t border-gray-100 pt-6">
                                       <h3 className="font-bold text-lg mb-4 flex items-center gap-2">
                                         <ChefHat size={20} className="text-emerald-600"/> Instructions
                                       </h3>
                                       <div className="space-y-4">
                                          {currentMeal.instructions.map((step, i) => (
                                            <div key={i} className="flex gap-4">
                                               <span className="flex-shrink-0 w-8 h-8 rounded-full bg-emerald-100 text-emerald-700 flex items-center justify-center font-bold text-sm">
                                                 {i + 1}
                                               </span>
                                               <p className="text-slate-600 leading-relaxed pt-1">{step}</p>
                                            </div>
                                          ))}
                                       </div>
                                    </div>
                                  </div>
                               </div>

                               <div className="bg-white rounded-2xl p-6 shadow-sm border border-gray-100">
                                  <h3 className="font-bold text-slate-800 mb-4">Complete the Meal</h3>
                                  <div className="flex flex-wrap gap-3">
                                     {currentMeal.sides.map((side, i) => (
                                       <div key={i} className="px-4 py-2 bg-indigo-50 text-indigo-700 rounded-xl text-sm font-medium">
                                         + {side}
                                       </div>
                                     ))}
                                  </div>
                               </div>
                            </div>

                            <div className="lg:col-span-1 space-y-6">
                               <div className="bg-white rounded-2xl shadow-sm border border-gray-100 p-6 sticky top-6">
                                  <h3 className="font-bold text-lg mb-6 flex items-center gap-2">
                                    <ShoppingCart size={20} className="text-emerald-600" /> Ingredients
                                  </h3>
                                  
                                  <div className="space-y-3 mb-8">
                                     {currentMeal.ingredients.map((ing, i) => (
                                       <div key={i} className="flex justify-between items-center text-sm p-2 hover:bg-gray-50 rounded-lg transition-colors">
                                          <span className="text-slate-700 font-medium">{ing.item}</span>
                                          <span className="text-slate-500 bg-gray-100 px-2 py-0.5 rounded text-xs">{ing.amount} {ing.unit}</span>
                                       </div>
                                     ))}
                                  </div>

                                  <div className="bg-amber-50 rounded-xl p-4 border border-amber-100">
                                     <h4 className="text-xs font-bold text-amber-800 uppercase mb-2">Nutrition Facts</h4>
                                     <div className="flex justify-between text-sm mb-1 text-amber-900">
                                        <span>Protein</span>
                                        <span className="font-bold">{currentMeal.nutrition.protein}</span>
                                     </div>
                                     <div className="flex justify-between text-sm mb-1 text-amber-900">
                                        <span>Carbs</span>
                                        <span className="font-bold">{currentMeal.nutrition.carbs}</span>
                                     </div>
                                     <div className="flex justify-between text-sm text-amber-900">
                                        <span>Fat</span>
                                        <span className="font-bold">{currentMeal.nutrition.fat}</span>
                                     </div>
                                  </div>

                                  <div className="mt-6 flex flex-wrap gap-2">
                                     {currentMeal.tags.map(tag => (
                                       <span key={tag} className="text-[10px] uppercase font-bold text-gray-500 border border-gray-200 px-2 py-1 rounded">
                                         {tag}
                                       </span>
                                     ))}
                                  </div>
                               </div>
                            </div>

                         </div>
                       ) : (
                         <div className="flex items-center justify-center h-full text-gray-400">Loading plan...</div>
                       )}
                    </div>
                  </div>
                )}

                {showCustomizeModal && (
                  <div className="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4">
                     <div className="bg-white rounded-2xl shadow-2xl w-full max-w-lg overflow-hidden">
                        <div className="bg-slate-900 p-4 flex justify-between items-center text-white">
                           <h3 className="font-bold text-lg">Customize Your Week</h3>
                           <button onClick={() => setShowCustomizeModal(false)}><XIcon size={20}/></button>
                        </div>
                        <div className="p-6 overflow-y-auto max-h-[60vh]">
                           <p className="text-sm text-slate-500 mb-4">Lock in a specific protein for each day.</p>
                           <div className="space-y-3">
                              {DAYS.map(day => (
                                 <div key={day} className="flex items-center justify-between border-b border-gray-100 pb-2">
                                    <span className="font-medium text-slate-700 w-24">{day}</span>
                                    <select 
                                       value={dailyProteins[day]}
                                       onChange={(e) => setDailyProteins({...dailyProteins, [day]: e.target.value})}
                                       className="block w-full rounded-md border-gray-300 shadow-sm focus:border-emerald-500 focus:ring-emerald-500 sm:text-sm p-2 bg-gray-50"
                                    >
                                       <option value="Any">Surprise Me (Any)</option>
                                       {Object.keys(PROTEIN_CUTS).map(p => <option key={p} value={p}>{p}</option>)}
                                    </select>
                                 </div>
                              ))}
                           </div>
                        </div>
                        <div className="p-4 bg-gray-50 border-t flex justify-end gap-2">
                           <button onClick={() => setShowCustomizeModal(false)} className="px-4 py-2 text-slate-600 hover:bg-gray-200 rounded-lg">Cancel</button>
                           <button 
                             onClick={regeneratePlan}
                             className="px-6 py-2 bg-emerald-600 text-white font-bold rounded-lg hover:bg-emerald-700"
                           >
                             Apply & Generate
                           </button>
                        </div>
                     </div>
                  </div>
                )}

                {activeTab === 'grocery' && (
                  <div className="flex-1 bg-white flex flex-col overflow-hidden">
                     <div className="p-6 border-b border-gray-100 flex justify-between items-center">
                        <h2 className="text-2xl font-bold text-slate-800">Shopping List</h2>
                        <button className="text-sm text-emerald-600 font-medium hover:underline">Share List</button>
                     </div>
                     <div className="flex-1 overflow-y-auto p-6 pb-24">
                        <div className="max-w-2xl mx-auto bg-gray-50 rounded-2xl p-6 shadow-inner">
                           {groceryList.length > 0 ? groceryList.map((item) => (
                             <div key={item.name} 
                                  onClick={() => toggleGroceryItem(item.name)}
                                  className={`flex items-center p-4 mb-2 bg-white rounded-xl border transition-all cursor-pointer ${
                                    checkedItems[item.name] ? 'opacity-50 grayscale border-transparent' : 'border-gray-100 shadow-sm hover:border-emerald-200'
                                  }`}>
                                <div className={`w-6 h-6 rounded-full border-2 flex items-center justify-center mr-4 transition-colors ${
                                  checkedItems[item.name] ? 'bg-emerald-500 border-emerald-500' : 'border-gray-300'
                                }`}>
                                   {checkedItems[item.name] && <CheckCircle size={14} className="text-white" />}
                                </div>
                                <div className="flex-1">
                                   <span className={`font-medium ${checkedItems[item.name] ? 'line-through text-gray-400' : 'text-slate-800'}`}>
                                     {item.name}
                                   </span>
                                </div>
                                <span className="text-xs font-bold text-slate-500 bg-gray-100 px-3 py-1 rounded-lg">
                                  {item.amountDisplay}
                                </span>
                             </div>
                           )) : (
                             <div className="text-center py-10 text-gray-500">No items found. Generate a plan first!</div>
                           )}
                        </div>
                     </div>
                  </div>
                )}

                {activeTab === 'settings' && (
                   <div className="flex-1 bg-gray-50 p-6 md:p-12 overflow-y-auto pb-24">
                      <div className="max-w-xl mx-auto bg-white rounded-3xl shadow-sm border border-gray-100 p-8">
                         <h2 className="text-2xl font-bold text-slate-800 mb-6">Meal Preferences</h2>
                         
                         <div className="space-y-6">
                            <div>
                               <label className="block text-sm font-bold text-slate-700 mb-3">Dietary Goal</label>
                               <div className="grid grid-cols-2 gap-2">
                                  {['None', 'Keto', 'Paleo', 'Vegan'].map(d => (
                                     <button
                                       key={d}
                                       onClick={() => setPrefs({...prefs, diet: d})}
                                       className={`px-4 py-3 rounded-xl text-sm font-bold border transition-all ${
                                         prefs.diet === d
                                         ? 'bg-emerald-600 text-white border-emerald-600'
                                         : 'bg-white text-slate-600 border-gray-200 hover:border-emerald-300'
                                       }`}
                                     >
                                       {d}
                                     </button>
                                  ))}
                               </div>
                            </div>

                            <div>
                               <label className="flex items-center p-4 border border-gray-200 rounded-xl cursor-pointer hover:border-emerald-500 transition-colors bg-white">
                                  <input 
                                    type="checkbox" 
                                    checked={prefs.kidFriendly} 
                                    onChange={() => setPrefs({...prefs, kidFriendly: !prefs.kidFriendly})}
                                    className="w-5 h-5 text-emerald-600 rounded focus:ring-emerald-500" 
                                  />
                                  <div className="ml-3">
                                     <span className="block font-medium text-slate-800">Kid Friendly Mode</span>
                                     <span className="block text-xs text-slate-500">Filters out spicy foods and complex tastes</span>
                                  </div>
                               </label>
                            </div>

                            <div>
                               <label className="flex items-center p-4 border border-gray-200 rounded-xl cursor-pointer hover:border-emerald-500 transition-colors bg-white">
                                  <input 
                                    type="checkbox" 
                                    checked={prefs.isFast} 
                                    onChange={() => setPrefs({...prefs, isFast: !prefs.isFast})}
                                    className="w-5 h-5 text-emerald-600 rounded focus:ring-emerald-500" 
                                  />
                                  <div className="ml-3">
                                     <span className="block font-medium text-slate-800">Busy Schedule Mode</span>
                                     <span className="block text-xs text-slate-500">Only show meals under 30 minutes</span>
                                  </div>
                               </label>
                            </div>

                            <div>
                               <label className="block text-sm font-bold text-slate-700 mb-3">Max Calories ({prefs.maxCalories})</label>
                               <input 
                                 type="range" 
                                 min="300" 
                                 max="1200" 
                                 step="50"
                                 value={prefs.maxCalories}
                                 onChange={(e) => setPrefs({...prefs, maxCalories: Number(e.target.value)})}
                                 className="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer"
                               />
                               <div className="flex justify-between text-xs text-gray-400 mt-2">
                                  <span>300 kcal</span>
                                  <span>1200 kcal</span>
                               </div>
                            </div>

                            <button 
                              onClick={() => {
                                regeneratePlan();
                                setActiveTab('dashboard');
                              }}
                              className="w-full py-4 bg-slate-900 text-white font-bold rounded-xl hover:bg-slate-800 transition-colors shadow-lg mt-4"
                            >
                               Save Preferences
                            </button>
                         </div>
                      </div>
                   </div>
                )}

                {activeTab === 'scanner' && (
                  <div className="flex-1 flex flex-col items-center justify-center bg-slate-900 text-white p-8 text-center overflow-y-auto">
                     {scanResults.length === 0 ? (
                        <>
                             <div className="bg-white/10 p-6 rounded-full mb-6 backdrop-blur-sm">
                                <Camera size={48} className={`text-emerald-400 ${isScanning ? 'animate-pulse' : ''}`} />
                             </div>
                             
                             {/* Preview Image if Available during scan */}
                             {scannedImage && isScanning && (
                               <div className="mb-6 relative w-48 h-48 rounded-2xl overflow-hidden border-4 border-emerald-500 shadow-2xl mx-auto">
                                  <img src={scannedImage} className="w-full h-full object-cover" />
                                  <div className="absolute inset-0 bg-black/40 flex items-center justify-center">
                                     <div className="w-8 h-8 border-4 border-white border-t-transparent rounded-full animate-spin"></div>
                                  </div>
                               </div>
                             )}

                             <h2 className="text-3xl font-bold mb-4">{isScanning ? 'Analyzing Photo...' : 'AI Pantry Scanner'}</h2>
                             <p className="max-w-md text-slate-300 mb-8">
                               {isScanning ? 'Identifying ingredients and checking pantry stock...' : 'Snap a photo of your fridge contents and let our AI engine invent recipes for you instantly.'}
                             </p>
                             
                             <input 
                                type="file" 
                                ref={fileInputRef} 
                                className="hidden" 
                                accept="image/*" 
                                capture="environment"
                                onChange={handleFileSelect}
                             />
                             
                             {!isScanning && (
                                 <button 
                                    onClick={() => fileInputRef.current.click()}
                                    className="px-8 py-3 bg-emerald-500 text-white font-bold rounded-full hover:bg-emerald-600 transition-colors shadow-lg"
                                 >
                                   Launch Camera
                                 </button>
                             )}
                        </>
                     ) : (
                        <div className="w-full max-w-4xl animate-in fade-in zoom-in duration-300 pb-20">
                            {/* Header & Scanned Image */}
                            <div className="flex flex-col md:flex-row items-center justify-between mb-8 gap-6">
                               <div className="text-left flex-1">
                                  <h2 className="text-3xl font-bold mb-2">Analysis Complete</h2>
                                  <p className="text-slate-400">We found {scanResults.length} recipes matching your ingredients.</p>
                               </div>
                               {scannedImage && (
                                 <div className="w-24 h-24 md:w-32 md:h-32 rounded-xl overflow-hidden border-2 border-slate-700 shadow-lg flex-shrink-0">
                                   <img src={scannedImage} className="w-full h-full object-cover" />
                                 </div>
                               )}
                            </div>

                            {/* Results Grid */}
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-4 text-left">
                                {scanResults.map((recipe, idx) => (
                                   <div key={idx} className="bg-white text-slate-800 rounded-2xl p-5 shadow-lg flex flex-col">
                                      <div className="flex justify-between items-start mb-2">
                                         <span className="bg-emerald-100 text-emerald-800 text-xs font-bold px-2 py-1 rounded uppercase">{recipe.protein}</span>
                                         <div className="flex items-center gap-1 text-xs text-slate-500 font-medium">
                                            <Clock size={14}/> {recipe.time}m
                                         </div>
                                      </div>
                                      <h3 className="text-xl font-bold mb-1 leading-tight">{recipe.name}</h3>
                                      <p className="text-sm text-slate-500 mb-4 flex-grow">
                                        Uses: {recipe.ingredients.slice(0,3).map(i => i.item).join(', ')}...
                                      </p>
                                      
                                      <button 
                                          onClick={() => {
                                              setWeeklyPlan(prev => {
                                                  const newPlan = [...prev];
                                                  // Find next available slot or just replace random day for demo
                                                  newPlan[idx % 7].recipe = recipe; 
                                                  return newPlan;
                                              });
                                              setActiveTab('dashboard');
                                              setScanResults([]);
                                              setScannedImage(null);
                                          }}
                                          className="w-full py-2 bg-slate-900 text-white text-sm font-bold rounded-lg hover:bg-emerald-600 transition-colors"
                                      >
                                          Add to Plan ({DAYS[idx % 7]})
                                      </button>
                                   </div>
                                ))}
                            </div>

                            <button 
                                onClick={() => {
                                    setScanResults([]);
                                    setScannedImage(null);
                                }}
                                className="mt-8 text-slate-400 hover:text-white underline"
                            >
                                Discard & Scan Again
                            </button>
                        </div>
                     )}
                  </div>
                )}

              </main>
            </div>
          );
        }

        const NavItem = ({ icon, label, active, onClick }) => (
          <button 
            onClick={onClick}
            className={`w-full flex items-center gap-3 px-4 py-3 rounded-xl transition-all ${
              active ? 'bg-emerald-600 text-white shadow-lg' : 'text-slate-400 hover:bg-slate-800 hover:text-white'
            }`}
          >
            {icon}
            <span className="font-medium text-sm">{label}</span>
          </button>
        );

        const MobileNavItem = ({ icon, label, active, onClick }) => (
          <button 
            onClick={onClick}
            className={`flex flex-col items-center justify-center p-2 rounded-lg transition-colors ${
              active ? 'text-emerald-600' : 'text-gray-400'
            }`}
          >
            {icon}
            <span className="text-[10px] font-medium mt-1">{label}</span>
          </button>
        );

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<MealPlannerApp />);
    </script>
</body>
</html>
